<!DOCTYPE html>

<head>
<title>[application name]</title>
<style type="text/css">
body {
	background: #eeeeee;
	font-family: sans-serif;
	color: #000000;
	margin: 0px;
	padding: 0px;}

html {
	height:100%;
	margin: 0px;
	padding: 0px;}
	
div#main {
	display: block;}
	
img#logo {
	margin-top: 15%;}
	
span#ldtext {
	display: block;
	font-size: 120%;
	margin-top: 80px;}
	
span#credits {
	position:fixed;
	left: 0;
	bottom: 0;
	padding: 5px;
	font-size: 80%;}
	
#canvas {
	width: 100%;
	height: 100%;}
	
progress#ldbar {
	margin-top: 15px;
	height: 5px;
	width: 400px;}
</style>
</head>

<body>
<center>
<div id="main">
<div id="ld">
<img id="logo" src="" alt="[application logo]">
<span id="ldtext">Downloading application...</span>
<progress id="ldbar" max="100" value="0"></progress>
<span id="credits">Powered by Panda3D and Emscripten</span>
</div>
<canvas id="canvas" style="display:none;" oncontextmenu="event.preventDefault()"></canvas>
<script type="text/javascript">
// The URL of the asm.js resource to load.
var EMSCRIPTEN_ASM = 'pview-panda.js';
// The uncompressed size of that resource (in bytes).
var ASM_SIZE = 7372469;

var ldtext = document.getElementById("ldtext");
var ldbar = document.getElementById("ldbar");
var ld = document.getElementById("ld");
var canvas = document.getElementById("canvas");

var Module = {
	canvas: (function() {
		return canvas;
	})(),
	setStatus: function(text) {
		if (!text) {
			ld.style.display = "none";
			canvas.style.display = "block";
		}
	},
	totalDependencies: 0,
	monitorRunDependencies: function(left) {
		this.totalDependencies = Math.max(this.totalDependencies, left);
		var percentComplete = Math.round(((this.totalDependencies-left) / this.totalDependencies)*100);
		ldbar.value = percentComplete;
	},
};
function updateProgress(evt) {
    var percentComplete = Math.round((evt.loaded / ASM_SIZE)*100);  
    ldbar.value = percentComplete;
}   
function sendreq() {  
    var req = new XMLHttpRequest();    
    req.onprogress=updateProgress;
    req.open('GET', EMSCRIPTEN_ASM, true); 
    req.onreadystatechange = function (aEvt) {  
        if (req.readyState == 4) 
        {  
            ldtext.innerHTML = 'Downloading dependencies...';
	    var script = document.createElement("script");
	    script.type = "text/javascript";
	    script.text = req.responseText;
	    document.body.appendChild(script);
        }  
    };  
    req.send(); 
}
window.onload = function() {
	sendreq();
}
</script>
</div>
</center>
</body>

</html>
